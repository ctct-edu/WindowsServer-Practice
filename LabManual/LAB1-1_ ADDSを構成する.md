---
lab：
    title： 'Active Directory Domain Service の高度な管理'
---

# ラボ1-1  - ADDSを構成する（目安：30分)

## 演習で使用するマシン

以下のマシンを使用します。

| マシン名               | 用途/目的                                                    |
| ---------------------- | ------------------------------------------------------------ |
| DomainController_1     | ドメイン「ctct.local」のドメインコントローラー1号機として構築します。 |
| DomainController_2     | ドメイン「ctct.local」のドメインコントローラー2号機として構築します。 |
| DomainController_Other | ドメイン「abc.com」のドメインコントローラーとして構築します。 |



## 実施内容

+ タスク 1：PowerShellスクリプトを使用してDC1を構成する
+ タスク 2：PowerShellスクリプトを使用してDC-Otherを構成する
+ タスク 3：DC1およびDC-Otherでインストール完了の確認
+ タスク 4：DC2をctct.localドメインに参加する
+ タスク５：DC2にADDSをインストールする
+ タスク６：DC2のADDSを構成する



## 手順

#### タスク 1：PowerShellスクリプトを使用してADDSをインストールする(DC1)

1. 「DomainController_1」にHyper-Vマネージャーからアクセスします。

1. ユーザー名とパスワードを入力してサインインします。

1. デスクトップ上にある「Install_ADDS_ctct_local_Forrest.ps1」を右クリックします。

1. 「PowerShellで実行」を選択します。PowerShellが起動します。

1. 「実行ポリシーの変更」という項目が表示されます。大文字のAと入力します。(すべて実行)

   ```powershell
   [Y] はい(Y)  [A] すべて続行(A)  [N] いいえ(N)  [L] すべて無視(L)  [S] 中断(S)  [?] ヘルプ
   (既定値は "N"):A
   ```

   > 参考：実行ポリシーとは
   >
   > 「実行ポリシーの変更」とは、Windows PowerShellでスクリプトの実行許可や制限の設定を変更することです。実行ポリシーは、PowerShellスクリプトやコマンドが安全に実行されるための制御手段であり、組織のセキュリティ方針に基づいて、信頼されていないスクリプトが実行されないように制限をかけます。ポリシーには「制限付き（Restricted）」「リモート署名付き（RemoteSigned）」「すべて許可（Unrestricted）」などのレベルがあり、システムやユーザーのニーズに応じて設定を変更することが可能です。
   >
   > ```powershell
   > 実行ポリシーの変更
   > 実行ポリシーは、信頼されていないスクリプトからの保護に役立ちます。実行ポリシーを変更すると
   > 、about_Execution_Policies のヘルプ トピック
   > (https://go.microsoft.com/fwlink/?LinkID=135170)
   > で説明されているセキュリティ上の危険にさらされる可能性があります。実行ポリシーを変更します
   > か?
   > [Y] はい(Y)  [A] すべて続行(A)  [N] いいえ(N)  [L] すべて無視(L)  [S] 中断(S)  [?] ヘルプ
   > (既定値は "N"):
   > ```

1. ADDSのインストールが開始されます。そのまま放置して、次のタスクに進みます。（インストールは約5～10分程度で完了します。)

   > 注：インストールが終わると自動で再起動されます。
   >
   > 注：スクリプト実行時に、黄色文字で2つの警告メッセージが表示されますが、無視してください。
   >
   > ```
   > 警告: Windows Server 2022 ドメイン コントローラーには、セキュリティ設定「Windows NT 4.0 と互換性のある暗号化アルゴリズムを許可する」の既定値が設定されています。これにより、セキュリティ チャネル セッションを確立する際に、セキュリティの弱い暗号化アルゴリズムの使用は許可されなくなります。この設定の詳細については、サポート技術情報 (KB) の記事 942564 を参照してください。
   > 
   > 警告: 権限のある親ゾーンが見つからないか、Windows DNS サーバーが実行されていないため、このDNS サーバーの委任を作成できません。既存の DNSインフラストラクチャと統合する場合は、ドメイン "ctct.local"外からの名前解決が確実に行われるように、親ゾーンでこのDNSサーバーへの委任を手動で作成する必要があります。それ以外の場合は、何もする必要はありません
   > ```

   

#### タスク 2：PowerShellスクリプトを使用してDC-Otherを構成する

1. 「DomainController_Other」にHyper-Vマネージャーからアクセスします。

1. ユーザー名とパスワードを入力してサインインします。

1. デスクトップ上にある「Install_ADDS_abc_com_Forest」を右クリックします。

1. 「PowerShellで実行」を選択します。PowerShellが起動します。

1. 「実行ポリシーの変更」という項目が表示されます。大文字のAと入力します。(すべて実行)

   ```powershell
   [Y] はい(Y)  [A] すべて続行(A)  [N] いいえ(N)  [L] すべて無視(L)  [S] 中断(S)  [?] ヘルプ
   (既定値は "N"):A
   ```

1. ADDSのインストールが開始されます。そのまま放置して、次のタスクに進みます。（インストールは約5～10分程度で完了します。)

   > 注：インストールが終わると自動で再起動されます。
   >
   > 注：スクリプト実行時に、黄色文字で2つの警告メッセージが表示されますが、無視してください。



#### タスク 3：DC1およびDC-Otherでインストール完了の確認

> 注：このタスクは、インストール再起動後から実施してください。

1. 「DomainController_1」および「DC-Other」にサインインします。

1. それぞれ、スタートメニューからPowerShellを起動します。

1. 以下のコマンドを入力します。

   > 注：コマンドはコピー&ペーストが可能です。

   ```powershell
   Get-WindowsFeature AD-Domain-Services
   ```

1. 以下の結果が返ってきたことを確認します。

   ```powershell
   Display Name                                            Name                       Install State
   ------------                                            ----                       -------------
   [X] Active Directory ドメイン サービス                  AD-Domain-Services             Installed
   ```



#### タスク 4：DC2をctct.localドメインに参加する

1. 「DomainController_2」にサインインします。

1. サーバーマネージャーが自動起動されます。

   > 注：サーバーマネージャーが表示されない場合はスタートメニューから選択してください。

1. サーバーマネージャーのウィンドウ左側にある「ローカル サーバー」をクリックします。

1. 「ワークグループ」項目の「WORKGROUP」をクリックします。

1. 「システムのプロパティ」が表示されます。「変更」をクリックします。

1. 「所属するグループ」を「ドメイン」に変更し、「ctct.local」と入力します。

1. 「コンピュータ名/ドメイン名の変更」が表示されます。ドメインの管理者ユーザーとパスワードを入力します。

   > 注：ドメインの管理者ユーザーはDC1のadministratorと同一です。

1. 「ctct.localドメインへようこそ」と表示されます。「OK」をクリックします。

1. 「これらの変更を適用・・・」と表示されます。「OK」をクリックします。

1. 「システムのプロパティ」が表示されます。「閉じる」をクリックします。

1. 「これらの変更を適用・・・」と表示されます。「今すぐ再起動」をクリックします。

1. DC２が再起動されます。再起動後に再びサインインします。



#### タスク５：DC2にADDSをインストールする

1. 「DomainController_2」にサインインします。

1. サーバーマネージャーが自動起動されます。

1. サーバーマネージャーウィンドウ右上の「管理」→「役割と機能の追加」の順でクリックします。

1. 役割と機能の追加ウィザードが表示されます。「開始する前に」では「次へ」をクリックします。

1. 「インストール種別の選択」では、何も変更せずに「次へ」をクリックします。

1. 「対象サーバーの選択」では、何も変更せずに「次へ」をクリックします。

1. 「サーバーの役割の選択」では「Active Directory ドメイン サービス」にチェックを入れます。

1. 「Active Directory ドメイン サービスに必要な・・・」と表示されます。「機能の追加」をクリックします。

1. 「サーバーの役割の選択」に戻ります。「次へ」をクリックします。

1. 「機能の選択」では、何も変更せずに「次へ」をクリックします。

1. 「Active Directory ドメイン サービス」では、何も変更せずに「次へ」をクリックします。

1. 「インストール オプションの確認」では、「インストール」をクリックし、終了まで待ちます。

1. インストール後、ウィンドウ中央にある「このサーバーをドメインコントローラーに昇格する」をクリックします。

   

#### タスク６：DC2のADDSを構成する

1. 「Active Directory ドメインサービス構成ウィザード」が表示されます。

1. 「配置構成」では「配置操作を選択してください」では「既存のドメインにドメインコントローラーを追加する」を選択します。

1. 「配置構成」では「ドメイン名の指定」が「ctct.local」になっていることを確認します。

1. 「配置構成」では「この操作を実行するには資格情報・・・」にて「変更」をクリックします。

1. 「配置操作の資格情報」ではドメイン管理者ユーザーを指定します。

   > 注：ドメインの管理者ユーザーはDC1のadministratorと同一です。

1. 「配置構成」にある「次へ」をクリックします。

1. 「ドメインコントローラーオプション」ウィンドウにあるパスワードには`Pa55w.rd1234`をそれぞれ入力し、「次へ」をクリックします。

1. 「DNSオプション」では、何も変更せずに「次へ」をクリックします。

1. 「追加オプション」では、何も変更せずに「次へ」をクリックします。

1. 「パス」では、何も変更せずに「次へ」をクリックします。

1. 「オプションの確認」では、何も変更せずに「次へ」をクリックします。

1. 「前提条件のチェック」では、では、何も変更せずに「インストール」をクリックします。インストールが終了するのを待ちます。

   > 注：いくつか警告が表示されていますが、無視してOKです。

1. インストール完了後、自動で再起動されます。再びサインインします。

1. スタートメニューからPowerShellを起動し、以下のコマンドを入力します。

   > 注：コマンドはコピー&ペーストが可能です。

   ```powershell
   $replicationStatus = (Get-ADReplicationPartnerMetadata -Target "dc2.ctct.local").LastReplicationResult
   if ($replicationStatus -eq 0) {
       Write-Host "dc2.ctct.local のレプリケーションは正常です。"
   } else {
       Write-Host "dc2.ctct.local のレプリケーションに問題があります。"
   }
   ```

1. 以下の結果が返ってきたことを確認します。

   ```powershell
   dc2.ctct.local のレプリケーションは正常です。
   ```





これでラボは完了です。お疲れ様でした。
